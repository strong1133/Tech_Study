> # TIL - 2021-03-31

## ğŸ’¡ ìŠ¤í”„ë§ 3ê³„ì¸µ

<hr/>

- ìŠ¤í”„ë§ì€ í”íˆ MVC íŒ¨í„´ìœ¼ë¡œ êµ¬ì¶•í•˜ê²Œ ëœë‹¤.
- ê·¸ë ‡ë‹¤ë©´ ìŠ¤í”„ë§ ì„œë²„ êµ¬ì¶•ì‹œ MVCíŒ¨í„´ì´ ì•„ë‹Œ ì¦‰,
  Controller, Service, Repositoryë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  êµ¬ì¶•í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ

> Servlet vs Controller

- Controllerì€ ìŠ¤í”„ë§ì„ í†µí•´ ë§¤í•‘ì„ í•´ì£¼ëŠ” ê²ƒ.
- Servletì€ ìë°”ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›¹í˜ì´ì§€ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ì„œë²„ì¸¡ í”„ë¡œê·¸ë¨ í˜¹ì€ ê·¸ ì‚¬ì–‘.

> ê´€ì‹¬ ìƒí’ˆ ë“±ë¡ API

<div style="text-Align:center">
<img src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4373bb07-df45-4a13-bdac-ce7564f8e239%2FUntitled.png?table=block&id=7734e5af-766a-414d-a0ad-9fb6586f6cbf&width=1240&userId=582806da-b4e3-4c8c-8573-a1b75f56bbb5&cache=v2" width="70%"></img></div>

- ìœ„ ì‚¬ì§„ì€ ê´€ì‹¬ìƒí’ˆ ë“±ë¡ì‹œ ì²˜ë¦¬ë˜ëŠ” ë¡œì§ì„ ë„ì‹í™” í•œê²ƒì¸ë°, Client, ì¤‘ê°„, Sever ëª¨ë‘ ì‚¬ìš©í•˜ëŠ” ì–¸ì–´ê°€ ë‹¤ë¥´ë‹¤.
- ë•Œë¬¸ì— ëª¨ë“  ê³¼ì • ì‚¬ì´ì‚¬ì´ì—ëŠ” ê° ì–¸ì–´ì— ë§ê²Œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ê²Œ ëœë‹¤.

1. Servlet ì½”ë“œ

```java
// ìš°ì„  JS -> JSON í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ JQueryë¥¼ í†µí•´ ë³€í™˜í•´ì„œ ì „ë‹¬ë  ê²ƒì´ë‹¤.

// ìš”ì²­ Body ì˜ JSON -> ìë°” ê°ì²´
        ProductRequestDto requestDto = null;
        StringBuffer jb = new StringBuffer();
        String line = null;
        try {
            BufferedReader reader = request.getReader();
            while ((line = reader.readLine()) != null)
                jb.append(line);

            ObjectMapper objectMapper = new ObjectMapper();
            requestDto = objectMapper.readValue(jb.toString(), ProductRequestDto.class);
        } catch (Exception e) { /*report an error*/ }

// ìë°” ê°ì²´ -> JSON ìœ¼ë¡œ ë³€í™˜
        ObjectMapper objectMapper = new ObjectMapper();
        String productJson = objectMapper.writeValueAsString(product);

        // ì‘ë‹µ ë³´ë‚´ê¸°
        response.setContentType("application/json");
        response.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
        out.print(productJson);
        out.flush();
```

2. ë°˜ë©´ Controller

```java
        @RestController // JSONìœ¼ë¡œ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ìŒì„ ì„ ì–¸í•©ë‹ˆë‹¤.
public class AllInOneController {
    // ì‹ ê·œ ìƒí’ˆ ë“±ë¡
    @PostMapping("/api/products")
    public Product createProduct(@RequestBody ProductRequestDto requestDto) throws SQLException {
        // ê´€ì‹¬ ìƒí’ˆ DB ì— ì €ì¥
				// ...

        // ì‘ë‹µ ë³´ë‚´ê¸°
        return product;
    }
}
```

 </br>

- Controllerì—ì„œëŠ” ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ JSONí˜•ì‹ìœ¼ë¡œ ì£¼ê³ ë°›ëŠ”ë‹¤ê³  ìŠ¤í”„ë§í•œí…Œ ì•Œë ¤ì£¼ë©´ í˜•ë³€í™˜ì€ ìŠ¤í”„ë§ì´ ì•Œì•„ì„œ í•´ì£¼ê²Œ ëœë‹¤. -> ì½”ë“œê°€ ê°„ê²°í•´ì§„ë‹¤!

 </br>
  </br>

> @Controller vs @RestController

- ì•ì„œ ë§í–ˆë“¯ ControllerëŠ” ì‚¬ìš©ìê°€ ì²˜ë¦¬í•˜ëŠ” ë¶€ë¶„ë³´ë‹¤ ìŠ¤í”„ë§ì—ì„œ ì•Œì•„ì„œ í•´ì£¼ëŠ” ë¶€ë¶„ì´ ë” ë§ë‹¤.
- ì´ì™€ ê°™ì€ ControllerëŠ” í¬ê²Œ ë‘ê°€ì§€ê°€ ìˆëŠ”ë°
  @Controller ì™€ @RestController ì´ë‹¤.

```java

@Controller
class ExamController {
	@GetMapping("/home")
	public String home() {
		return "/home.html";
	}
}
// ControllerëŠ” ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ viewë¥¼ í†µí•œ /home.html ë¡œ ì‘ë‹µ í•œë‹¤.
//JSONì‘ë‹µì„ ë°›ê¸° ìœ„í•´ì„ 

@Controller
class ExamController {
	@Autowird
	private ProductRepository productRepository

	@GetMapping("/product/list")
	public @ResponseBody List<Product> getProducts() {
		return productRepository.findAll();
	}
}

// @ResponseBody ë¥¼ ì´ìš©í•´ì•¼ í•œë‹¤.
```

> ë°˜ë©´ RestControllerëŠ”

```java

@RestController
class ExamController {
	@Autowird
	private ProductRepository productRepository

	@GetMapping("/product/list")
	public List<Product> getProducts() {
		return productRepository.findAll();
	}
}

// RestController = Controller + ResponseBody ì´ë‹¤.
// ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ JSONê°ì²´ë¡œ í•´ì¤€ë‹¤!
```

</br></br></br>

## ğŸ’¡ ê°ì²´ì§€í–¥

<hr/>

- Controller í•˜ë‚˜ë§Œìœ¼ë¡œë„ ê´€ì‹¬ìƒí’ˆ ë“±ë¡ êµ¬í˜„ì´ ê°€ëŠ¥í•˜ë‹¤.
- ê·¸ë ‡ë‹¤ë©´ Service, RepositoryëŠ” ì™œ í•„ìš”í•˜ê³  ì–´ì§¸ì„œ Controllerí•˜ë‚˜ë§Œìœ¼ë¡œ ì˜ ë™ì‘í• ê¹Œ

> AllInOneController

1. ìš”ì²­ì„ ë°›ëŠ” ë¶€ë¶„ì„ ë§Œë“ ë‹¤
2. ìš”ì²­ì„ ë°›ì•„ DTOì— ì‹¤ì–´ DBì— ì €ì¥í•  ê°ì²´ë¥¼ ë§Œë“ ë‹¤.
3. DBì— ì—°ê²°í•œë‹¤.
4. DB Queryë¥¼ ë§Œë“ ë‹¤.
5. DB Queryë¥¼ ìƒì„±í•œë‹¤.
6. DB ì—°ê²°ì„ ëŠëŠ”ë‹¤.
7. ìš”ì²­ì— ëŒœí•œ ì‘ë‹µì„ ë°˜í™˜í•´ì¤€ë‹¤.

- Controllerí•˜ë‚˜ë§Œìœ¼ë¡œ ë§Œë“¤ë ¤ë©´ ìœ„ì™€ ê°™ì€ ë¡œì§ì„ ì†ìˆ˜ êµ¬í˜„ í•´ì¤˜ì•¼í•œë‹¤.
- ê·¸ëŸ´ë ¤ë©´ DBì— ëŒ€í•´ ì•Œì•„ì•¼í•˜ê³  ì¿¼ë¦¬ì— ëŒ€í•´ë„ ì•Œì•„ì•¼í•œë‹¤.
- ë˜í•œ ë‹¤ë¥¸ ìš”ì²­ì— ëŒ€í•œ ë§¤ì†Œë“œë¥¼ êµ¬í˜„ í•  ë•Œë„ 1~7ê¹Œì§€ ê³¼ì •ì„ ë˜‘ê°™ì´ ë§Œë“¤ì–´ì¤˜ì•¼í•œë‹¤. -> `ì½”ë“œê°€ ê¸¸ì–´ì§„ë‹¤.`
- ë˜í•œ Entity ìª½ì´ë‚˜ DBì—ëŒ€í•œ ì ‘ê·¼ ì •ë³´ë¥¼ ë³€ê²½í•˜ê²Œ ë˜ë©´ ë§¤ì†Œë“œë§ˆë‹¤ ë°”ê¿”ì¤˜ì•¼ í•œë‹¤. ë§¤í•‘ë§¤ì†Œë“œê°€ 100ê°œë©´ 100ê°œì— ëŒ€í•˜ ê°ê° í•´ë‹¹ ë¶€ë¶„ì„ ì°¾ì•„ ì†ìˆ˜ ë°”ê¿”ì¤˜ì•¼í•¨ -> `ìœ ì§€ë³´ìˆ˜ ë° í™•ì¥ì„±ì´ ì•ˆì¢‹ë‹¤.`

> ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë° vs. ì ˆì°¨ì  í”„ë¡œê·¸ë˜ë°

- ì•ì„œ ë§í•œ AllInOneControllerëŠ” ì ˆì°¨ì  ë°©ì‹ì´ë‹¤. API í´ë˜ìŠ¤ê°€ ìˆ˜í–‰í•´ì•¼ í•  ì¼ë“¤ì„ ì­ˆìš± ë‚˜ì—´í•´ ë†“ëŠ” ë°©ì‹ì´ë‹¤.
- ì ˆì°¨ì  í”„ë¡œê·¸ë˜ë°ì˜ ë‹¨ì ì€ ì½”ë“œê°€ ë³µì¡í•˜ê³  ì¤‘ë³µ ë‚´ìš©ì´ ë§ë‹¤ëŠ” ì ì´ë‹¤.
- ìì£¼ ì“°ì´ëŠ” ì•„ì´ë“¤ì„ ë¯¸ë¦¬ ê·¸ ì—­í™œì„ ì •í•´ì£¼ê³  ê·¸ë•Œ ê·¸ë•Œ ê°€ì ¸ë‹¤ê°€ ì“¸ìˆ˜ ìˆê²Œ í•˜ë©´ ì¢‹ì§€ ì•Šì„ê¹Œ í•˜ëŠ” ì ì—ì„œ OOPê°€ ì¶œë°œí–ˆë‹¤.

> ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë°

- ì˜ˆë¥¼ ë“¤ì–´ ìƒ‰ì¢…ì´ë¥¼ ìë¥´ëŠ” ì¼ì„ í•œë‹¤ í•˜ë©´
- 1ë²ˆ ìƒ‰ì¢…ì´ë¥¼ ìë¥¼ë•Œ ê°€ìœ„ë¥¼ ë§Œë“¤ì–´ì£¼ê³  ìë¥¸ ìƒ‰ì¢…ì´ë¥¼ ë°˜í™˜í•œë‹¤.
- 2ë²ˆ ìƒ‰ì¢…ì´ë¥¼ ìë¥¼ë•Œ ê°€ìœ„ë¥¼ ìƒˆë¡œ ë§Œë“¤ í•„ìš”ê°€ ìˆì„ê¹Œ? 1ë²ˆ ìƒ‰ì¢…ì´ì— ë§Œë“  ê°€ìœ„ë¥¼ ì“¸ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ?
- í•˜ì§€ë§Œ 1ë²ˆ ìƒ‰ì¢…ì´ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê³µê°„ì—ì„œ ë§Œë“  ê°€ìœ„ëŠ” 2ë²ˆ ìƒ‰ì¢…ì´ë¥¼ ìë¥¼ë–¼ ë¹Œë ¤ì˜¬ìˆ˜ ì—†ë‹¤. ì™œëƒ, 1ë²ˆ ìƒ‰ì¢…ì´ ì „ìš© ê°€ìœ„ì´ê¸° ë•Œë¬¸
- ê·¸ë ‡ë‹¤ë©´ ëª¨ë‘ê°€ ê³µìš©ìœ¼ë¡œ ì“¸ìˆ˜ ìˆëŠ” ê°€ìœ„ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ ë†“ê³  ìƒ‰ì¢…ì´ë“¤ì´ ê·¸ë•Œê·¸ë•Œ í˜¸ì¶œí•´ì„œ ì“°ë©´ ì–´ë–¨ê¹Œ í•˜ëŠ” ê²ƒì´ ê°ì²´ ì§€í–¥ì´ë‹¤.

- AllInOneControllerì—ì„œ DBì— ê´€í•œ ë¡œì§, ë°ì´í„°ë¥¼ ë³€ê²½í•´ì£¼ëŠ” ë¡œì§ë“¤ì´ ì¤‘ë³µì ì´ ë§ì•„
- í¬ê²Œ 3ê°œë¡œ ë¶„ë¦¬í•œê²ƒì´ Controller, Service, Repositoryì´ë‹¤.

1.  Controller

        - í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ë°›ìŒ.
        - ìš”ì²­ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ ì„œë¹„ìŠ¤ë¥¼ ë¶ˆëŸ¬ì„œ ì‹œí‚¨ë‹¤.
        - í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‘ë‹µì„ ë°˜í™˜.

2.  Service

        - Controllerê°€ ë¶€ë¥´ë©´ ì¶œë™í•´ì„œ ë¡œì§ì„ ì²˜ë¦¬í•œë‹¤.
        - ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§ì„ ì²˜ë¦¬.
        - DB ë‹¨ì€ Repositoryë¥¼ ë¶ˆëŸ¬ì„œ ì‹œí‚¨ë‹¤.

3.  Repository

        - DB CRUD
        - DB ì—°ê²°, í•´ì œ

<div style="text-Align:center">
<img src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F25b09b2a-863b-4fa5-9ac0-1eab0f31bdba%2FUntitled.png?table=block&id=96ac5a75-fa22-4c3c-8e7b-37b381e24b97&width=1770&userId=582806da-b4e3-4c8c-8573-a1b75f56bbb5&cache=v22" width="70%"></img></div>
